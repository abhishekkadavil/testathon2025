version: 0.1

runson: ubuntu-latest

env:
  JAVA_HOME: /usr/lib/jvm/java-17-openjdk-amd64

pre:
  - sudo apt-get update
  - sudo apt-get install -y openjdk-17-jdk maven python3 python3-pip
  - pip install flask requests

  # Start the Flask API
  - echo "Starting Flask API..."
  - nohup python3 app.py > flask.log 2>&1 &
  - |
    for i in {1..20}; do
      curl -s http://127.0.0.1:5000/employee && break
      echo "Waiting..."
      sleep 1
    done

testSuites:
  - suiteName: "Gatling API Load Test"
    tests:
      - mvn -q gatling:test

uploadArtefacts:
  - name: gatling-report
    path: target/gatling
