version: 0.1

runson: ubuntu-latest

env:
  JAVA_HOME: /usr/lib/jvm/java-17-openjdk-amd64

pre:
  - sudo apt-get update
  - sudo apt-get install -y openjdk-17-jdk maven

  # Start your Flask API (same as GitHub workflow)
  - echo "Starting Flask app..."
  - nohup python3 app.py > flask.log 2>&1 &

  - echo "Waiting for API..."
  - |
    for i in {1..20}; do
      curl -s http://127.0.0.1:5000/employee && break
      echo "Waiting..."
      sleep 1
    done

testSuites:
  - suiteName: "Gatling Load Test"
    tests:
      - mvn -q gatling:test

# Upload Gatling HTML reports
uploadArtefacts:
  - name: "gatling-reports"
    path: "target/gatling"
